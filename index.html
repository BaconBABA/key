<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LootLink Task Verification</title>
    <style>
        :root {
            --primary: #4a00e0;
            --primary-dark: #3900b3;
            --secondary: #8e2de2;
            --background: #f9f9f9;
            --text: #333;
            --card: #ffffff;
            --error: #ff4757;
            --success: #2ed573;
            --warning: #ffa502;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            flex: 1;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary);
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .card {
            background-color: var(--card);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        h1, h2, h3 {
            color: var(--primary);
        }

        .button-container {
            margin: 2rem 0;
            display: flex;
            justify-content: center;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .result {
            margin-top: 1.5rem;
            padding: 1rem;
            border-radius: 5px;
            font-family: monospace;
            font-size: 1.1rem;
            word-break: break-all;
            background-color: #f1f1f1;
            display: none;
        }

        .success {
            border-left: 4px solid var(--success);
            background-color: rgba(46, 213, 115, 0.1);
        }

        .error {
            border-left: 4px solid var(--error);
            background-color: rgba(255, 71, 87, 0.1);
        }

        .warning {
            border-left: 4px solid var(--warning);
            background-color: rgba(255, 165, 2, 0.1);
        }

        .key-section {
            display: none;
        }

        .hwid-info {
            margin-bottom: 1.5rem;
            padding: 0.8rem;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }

        .timer {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #777;
        }

        .countdown {
            font-weight: bold;
            color: var(--primary);
        }

        .raw-link {
            display: block;
            padding: 1rem;
            background-color: #f0f0f0;
            border-radius: 5px;
            margin-top: 1rem;
            overflow-x: auto;
        }

        footer {
            text-align: center;
            padding: 1.5rem;
            background-color: var(--primary);
            color: white;
            margin-top: auto;
        }

        .steps {
            counter-reset: step;
            list-style-type: none;
            padding-left: 0;
        }

        .steps li {
            position: relative;
            margin-bottom: 1.5rem;
            padding-left: 3rem;
        }

        .steps li::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            left: 0;
            top: 0;
            width: 2rem;
            height: 2rem;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .pending {
            background-color: var(--warning);
        }

        .completed {
            background-color: var(--success);
        }

        .progress-container {
            margin: 2rem 0;
        }

        .progress-bar {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background-color: var(--primary);
            width: 0;
            transition: width 0.3s ease;
        }

        @media (max-width: 600px) {
            .container {
                padding: 1rem;
            }
            
            .card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">LootLink</div>
            <p>Task Verification & Key Generator</p>
        </header>

        <div class="card" id="redirectCard">
            <h2>Task Verification Required</h2>
            <p>To generate your unique HWID-based key, you need to complete a quick verification task.</p>
            
            <ol class="steps">
                <li>
                    Click the button below to navigate to the verification page
                    <div class="status-indicator" id="step1Status">
                        <div class="indicator pending"></div>
                        <span>Pending</span>
                    </div>
                </li>
                <li>
                    Complete the required task on the external site
                    <div class="status-indicator" id="step2Status">
                        <div class="indicator pending"></div>
                        <span>Pending</span>
                    </div>
                </li>
                <li>
                    Return to this page and verify completion
                    <div class="status-indicator" id="step3Status">
                        <div class="indicator pending"></div>
                        <span>Pending</span>
                    </div>
                </li>
            </ol>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress" id="progressBar"></div>
                </div>
            </div>
            
            <div class="button-container">
                <button id="redirectBtn" onclick="redirectToTask()">
                    Go to Verification Task
                </button>
            </div>
            
            <div id="taskResult" class="result warning">
                This system includes anti-bypass protection. Attempting to skip the verification process will result in invalid keys.
            </div>
        </div>

        <div class="card key-section" id="keyCard">
            <h2>Generate Your Key</h2>
            <p>Task verification completed! You can now generate a unique key linked to your hardware.</p>
            
            <div class="hwid-info" id="hwidInfo">Detecting your hardware ID...</div>
            
            <div class="button-container">
                <button id="generateBtn" disabled>
                    <span id="generateBtnText">Generate Key</span>
                </button>
            </div>
            
            <div id="keyResult" class="result"></div>
            
            <div class="timer">
                Next key reset in <span id="countdown" class="countdown">60:00</span>
            </div>
        </div>
    </div>

    <footer>
        <p>Â© 2025 LootLink Verification System. All rights reserved.</p>
    </footer>

    <script>
        // Global variables
        const TASK_URL = 'https://lootdest.org/s?KTz9Kydo';
        let taskCompleted = false;
        let currentHwid = null;
        let verificationToken = null;
        
        // Check if returning from task
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize elements
            const redirectCard = document.getElementById('redirectCard');
            const keyCard = document.getElementById('keyCard');
            const step1Status = document.getElementById('step1Status');
            const step2Status = document.getElementById('step2Status');
            const step3Status = document.getElementById('step3Status');
            const progressBar = document.getElementById('progressBar');
            const taskResult = document.getElementById('taskResult');
            const generateBtn = document.getElementById('generateBtn');
            const generateBtnText = document.getElementById('generateBtnText');
            const hwidInfo = document.getElementById('hwidInfo');
            const keyResult = document.getElementById('keyResult');
            const countdownElement = document.getElementById('countdown');
            
            // Check if we're returning from the task page
            const urlParams = new URLSearchParams(window.location.search);
            verificationToken = urlParams.get('verification');
            
            if (verificationToken) {
                // Validate the verification token (would be more secure on server-side)
                verifyTaskCompletion(verificationToken);
            }
            
            // Update countdown timer
            function updateCountdown() {
                const now = new Date();
                const minutesLeft = 59 - now.getMinutes();
                const secondsLeft = 59 - now.getSeconds();
                
                const formattedTime = `${minutesLeft.toString().padStart(2, '0')}:${secondsLeft.toString().padStart(2, '0')}`;
                countdownElement.textContent = formattedTime;
            }
            
            // Function to verify task completion
            function verifyTaskCompletion(token) {
                // Update UI to show verification in progress
                updateProgressUI(1);
                
                // In a real implementation, this would make a secure API call to verify the token
                // For demonstration purposes, we'll simulate verification
                setTimeout(() => {
                    // Simulate token validation logic
                    // In production, this would be a secure server-side check
                    const isValid = validateVerificationToken(token);
                    
                    if (isValid) {
                        // Mark task as completed
                        taskCompleted = true;
                        updateProgressUI(3);
                        
                        // Show the key generation section
                        setTimeout(() => {
                            redirectCard.style.display = 'none';
                            keyCard.style.display = 'block';
                            
                            // Start HWID detection
                            detectHardwareID();
                        }, 1000);
                    } else {
                        // Invalid verification
                        updateProgressUI(1);
                        
                        taskResult.className = 'result error';
                        taskResult.style.display = 'block';
                        taskResult.textContent = 'Verification failed. The token is invalid or expired. Please try again.';
                    }
                }, 2000);
            }
            
            // Function to validate the verification token
            function validateVerificationToken(token) {
                // In a real implementation, this would verify the token with your backend
                // For demonstration, we'll check if it matches a specific pattern
                
                // Simple check: token should be at least 20 chars and start with "VERIFY-"
                if (token && token.length >= 20 && token.startsWith('VERIFY-')) {
                    return true;
                }
                
                // For demo purposes, also accept "demo" as a valid token
                if (token === 'demo') {
                    return true;
                }
                
                return false;
            }
            
            // Update the progress UI based on current step
            function updateProgressUI(step) {
                // Update step indicators
                if (step >= 1) {
                    step1Status.innerHTML = '<div class="indicator completed"></div><span>Completed</span>';
                    progressBar.style.width = '33%';
                }
                
                if (step >= 2) {
                    step2Status.innerHTML = '<div class="indicator completed"></div><span>Completed</span>';
                    progressBar.style.width = '66%';
                }
                
                if (step >= 3) {
                    step3Status.innerHTML = '<div class="indicator completed"></div><span>Completed</span>';
                    progressBar.style.width = '100%';
                    
                    // Update task result message
                    taskResult.className = 'result success';
                    taskResult.style.display = 'block';
                    taskResult.textContent = 'Task verification completed successfully! You can now generate your key.';
                }
            }
            
            // Detect hardware ID
            function detectHardwareID() {
                hwidInfo.textContent = "Detecting your hardware...";
                
                // Simulate hardware detection (in a real app, this would use Canvas, WebGL, etc.)
                setTimeout(() => {
                    try {
                        const canvas = document.createElement('canvas');
                        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                        
                        let components = [];
                        
                        // Browser and OS info
                        components.push(navigator.userAgent);
                        components.push(navigator.language);
                        components.push(navigator.hardwareConcurrency);
                        components.push(screen.width + 'x' + screen.height + 'x' + screen.colorDepth);
                        
                        // WebGL fingerprinting
                        if (gl) {
                            components.push(gl.getParameter(gl.VENDOR));
                            components.push(gl.getParameter(gl.RENDERER));
                        }
                        
                        // Local timezone
                        components.push(Intl.DateTimeFormat().resolvedOptions().timeZone);
                        
                        // Use verification token as additional seed
                        if (verificationToken) {
                            components.push(verificationToken);
                        }
                        
                        // Generate hash from components
                        const hwid = generateHwidFromComponents(components);
                        
                        // Format the HWID in a readable format
                        currentHwid = `HWID-${hwid.substring(0, 4)}-${hwid.substring(4, 8)}-${hwid.substring(8, 12)}-${hwid.substring(12, 16)}`;
                        
                        // Display HWID and enable button
                        hwidInfo.textContent = currentHwid;
                        generateBtn.disabled = false;
                        
                    } catch (error) {
                        hwidInfo.textContent = "Error detecting hardware ID";
                        console.error(error);
                    }
                }, 1500);
            }
            
            // Generate HWID from component array
            function generateHwidFromComponents(components) {
                // Join all components and create a hash
                const componentString = components.join('|');
                
                function simpleHash(str) {
                    let hash = 0;
                    for (let i = 0; i < str.length; i++) {
                        const char = str.charCodeAt(i);
                        hash = ((hash << 5) - hash) + char;
                        hash = hash & hash; // Convert to 32bit integer
                    }
                    return Math.abs(hash).toString(16).padStart(8, '0');
                }
                
                // Create multiple hashes and combine them
                const hash1 = simpleHash(componentString);
                const hash2 = simpleHash(componentString.split('').reverse().join(''));
                
                return (hash1 + hash2).substring(0, 16).toUpperCase();
            }
            
            // Generate key based on HWID and current time
            function generateKey() {
                if (!currentHwid) {
                    keyResult.className = 'result error';
                    keyResult.style.display = 'block';
                    keyResult.textContent = 'Unable to detect your hardware ID. Please refresh the page.';
                    return;
                }
                
                if (!taskCompleted && !verificationToken) {
                    keyResult.className = 'result error';
                    keyResult.style.display = 'block';
                    keyResult.textContent = 'You must complete the verification task first.';
                    return;
                }
                
                // Show loading state
                generateBtn.disabled = true;
                generateBtnText.innerHTML = '<span class="loading"></span>Generating...';
                
                // Simulate API call delay
                setTimeout(() => {
                    try {
                        // Get current time components for the hourly reset
                        const now = new Date();
                        const currentHour = now.getHours();
                        const currentDay = now.getDate();
                        const currentMonth = now.getMonth() + 1;
                        
                        // Simple hash function
                        function simpleHash(str) {
                            let hash = 0;
                            for (let i = 0; i < str.length; i++) {
                                const char = str.charCodeAt(i);
                                hash = ((hash << 5) - hash) + char;
                                hash = hash & hash;
                            }
                            return Math.abs(hash).toString(16);
                        }
                        
                        // Create key components with anti-bypass measures
                        const hwidHash = simpleHash(currentHwid);
                        const timeSalt = simpleHash(`${currentDay}${currentMonth}${currentHour}`);
                        
                        // Verification token is included in the anti-bypass hash
                        const antiBypass = simpleHash(hwidHash + timeSalt + verificationToken);
                        
                        // Combine components to create the key
                        const key = `LL-${hwidHash.substring(0, 6)}-${timeSalt.substring(0, 6)}-${antiBypass.substring(0, 8)}`;
                        
                        // Create raw link format
                        const rawLink = `lootlink://auth/${key}/${currentHwid}/${Math.floor(now.getTime() / 1000)}`;
                        
                        // Display the key
                        keyResult.className = 'result success';
                        keyResult.style.display = 'block';
                        keyResult.innerHTML = `
                            <strong>Your Key:</strong> ${key}
                            <p>This key will reset at the top of the next hour.</p>
                            <div>
                                <strong>Raw Link:</strong>
                                <code class="raw-link">${rawLink}</code>
                            </div>
                        `;
                        
                        // Reset button state
                        generateBtn.disabled = false;
                        generateBtnText.textContent = 'Regenerate Key';
                        
                    } catch (error) {
                        keyResult.className = 'result error';
                        keyResult.style.display = 'block';
                        keyResult.textContent = 'An error occurred while generating your key. Please try again.';
                        console.error(error);
                        
                        generateBtn.disabled = false;
                        generateBtnText.textContent = 'Generate Key';
                    }
                }, 2000);
            }
            
            // Event listeners
            generateBtn.addEventListener('click', generateKey);
            
            // Initialize countdown
            updateCountdown();
            setInterval(updateCountdown, 1000);
        });
        
        // Redirect to task function
        function redirectToTask() {
            // Update UI
            const step1Status = document.getElementById('step1Status');
            step1Status.innerHTML = '<div class="indicator completed"></div><span>Completed</span>';
            
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = '33%';
            
            const redirectBtn = document.getElementById('redirectBtn');
            redirectBtn.innerHTML = '<span class="loading"></span>Redirecting...';
            redirectBtn.disabled = true;
            
            // Simulate a short delay before redirect
            setTimeout(() => {
                // In a real implementation, you would set a cookie or localStorage flag
                // to track that the user started the task
                localStorage.setItem('taskStarted', 'true');
                localStorage.setItem('taskStartTime', Date.now());
                
                // Redirect to the task URL
                window.location.href = TASK_URL;
            }, 1500);
        }
    </script>
</body>
</html>
